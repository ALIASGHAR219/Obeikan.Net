
<section class="home-content">
  <ul class="breadcrumb">
    <li class="breadcrumb-item">
      <a class="breadcrumb-link" routerLink="/home">Home</a>
    </li>
    <li class="breadcrumb-item">
      <a class="breadcrumb-link" routerLink="/administration">O3 Administration</a>
    </li>
    <li class="breadcrumb-item">
      <a class="breadcrumb-link" routerLink="/usermanagement">User Management</a>
    </li> 
    <!-- <li class="breadcrumb-item">
      <a class="breadcrumb-link" routerLink="/users">Users</a>
    </li>  -->
  </ul>
<mat-card class="p-mt-0 p-pt-0">
  <div class="p-d-flex p-jc-between p-ai-center">
      <mat-card-title class="p-ml-2">All Users</mat-card-title>
      <div class="">
        <mat-form-field>
          <input matInput (keyup)="applyFilter($event)" placeholder="Search...." autocomplete="off">
        </mat-form-field>
      </div>
      <div class="">
        <button mat-flat-button class="btn-add-item" (click)="openModal()" pTooltip="Add User" tooltipPosition="top">
          <span class="btn-icon">
            <svg width="40" height="36" viewBox="0 0 10 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M9.18143 5.4235H5.6525V8.9235H4.47619V5.4235H0.947266V4.25684H4.47619V0.756836H5.6525V4.25684H9.18143V5.4235Z"
                fill="white" />
            </svg>
          </span>
        </button>
      
      </div>            
  </div>
  <mat-card-content>
    <ngx-spinner
        [fullScreen]="false"
        bdColor="#fff"
        size="medium"
        color="#050a4f"
        type="ball-clip-rotate-multiple"
        >
        <p style="font-size: 20px; color: #050a4f">Fetching User Data...</p>
  </ngx-spinner>
  <div class="wrapper-box wrapper-box-shadow table-wrapper p-p-1">
    <table mat-table [dataSource]="userData" class="basic-table plant-model-table" matSort>

      <!-- groupID Column -->
      <ng-container matColumnDef="userId">
        <th mat-header-cell *matHeaderCellDef mat-sort-header class="header-min-width">
          <p class="header-text">User ID</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.userId}} </td>
      </ng-container>

      <!-- groupDescription Column -->
      <ng-container matColumnDef="firstname">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="header-text">First  Name</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.firstname}} </td>
      </ng-container>
      <ng-container matColumnDef="lastname">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="header-text">Last Name</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.lastname}} </td>
      </ng-container>
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="header-text">Email</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.email}} </td>
      </ng-container>
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="header-text">Phone</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.phone}} </td>
      </ng-container>

      <!-- remarks Column -->
      <ng-container matColumnDef="role">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="header-text">Role</p>
        </th>
        <td mat-cell *matCellDef="let element"> {{element.role}} </td>
      </ng-container>  
      <!-- plantModelActions Column -->
      <ng-container matColumnDef="userActions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element" class="row-action-btns-column">
          <div class="row-action-btns">
            <button mat-icon-button class="edit-btn" aria-label="Edit User" 
            (click)="getOneUser(element.userId)" pTooltip="Edit User" tooltipPosition="top">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M0.75 9.06298V11.2505H2.9375L9.38917 4.79881L7.20167 2.61131L0.75 9.06298ZM11.0808 3.10715C11.3083 2.87965 11.3083 2.51215 11.0808 2.28465L9.71583 0.919648C9.48833 0.692148 9.12083 0.692148 8.89333 0.919648L7.82583 1.98715L10.0133 4.17465L11.0808 3.10715Z"
                  fill="white" />
              </svg>
            </button>
            <button mat-icon-button class="node-control-btn node-delete" aria-label="delete item"
              (click)="deleteUser(element.userId)" pTooltip="Delete User" tooltipPosition="top">
              <svg width="8" height="10" viewBox="0 0 8 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M7.35547 0.9375H5.60547L5.10547 0.4375H2.60547L2.10547 0.9375H0.355469V1.9375H7.35547V0.9375ZM0.855469 8.4375C0.855469 8.70272 0.960826 8.95707 1.14836 9.14461C1.3359 9.33214 1.59025 9.4375 1.85547 9.4375H5.85547C6.12069 9.4375 6.37504 9.33214 6.56258 9.14461C6.75011 8.95707 6.85547 8.70272 6.85547 8.4375V2.4375H0.855469V8.4375Z"
                  fill="white" />
              </svg>
            </button>
            <button mat-icon-button class="edit-btn" aria-label="Edit Row" 
            (click)="openPermissionModal(element.userId)" pTooltip="Edit Permissions" tooltipPosition="top">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                d="M15.808,14.066H6.516v-1.162H5.354v1.162H4.193c-0.321,0-0.581,0.26-0.581,0.58s0.26,0.58,0.581,0.58h1.162
                v1.162h1.162v-1.162h9.292c0.32,0,0.58-0.26,0.58-0.58S16.128,14.066,15.808,14.066z M15.808,9.419h-1.742V8.258h-1.162v1.161
                h-8.71c-0.321,0-0.581,0.26-0.581,0.581c0,0.321,0.26,0.581,0.581,0.581h8.71v1.161h1.162v-1.161h1.742
                c0.32,0,0.58-0.26,0.58-0.581C16.388,9.679,16.128,9.419,15.808,9.419z M17.55,0.708H2.451c-0.962,0-1.742,0.78-1.742,1.742v15.1
                c0,0.961,0.78,1.74,1.742,1.74H17.55c0.962,0,1.742-0.779,1.742-1.74v-15.1C19.292,1.488,18.512,0.708,17.55,0.708z M18.13,17.551
                c0,0.32-0.26,0.58-0.58,0.58H2.451c-0.321,0-0.581-0.26-0.581-0.58v-15.1c0-0.321,0.26-0.581,0.581-0.581H17.55
                c0.32,0,0.58,0.26,0.58,0.581V17.551z M15.808,4.774H9.419V3.612H8.258v1.162H4.193c-0.321,0-0.581,0.26-0.581,0.581
                s0.26,0.581,0.581,0.581h4.065v1.162h1.161V5.935h6.388c0.32,0,0.58-0.26,0.58-0.581S16.128,4.774,15.808,4.774z"                          fill="white" />
              </svg>
              <!-- <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill="none" d="M15.808,14.066H6.516v-1.162H5.354v1.162H4.193c-0.321,0-0.581,0.26-0.581,0.58s0.26,0.58,0.581,0.58h1.162
                  v1.162h1.162v-1.162h9.292c0.32,0,0.58-0.26,0.58-0.58S16.128,14.066,15.808,14.066z M15.808,9.419h-1.742V8.258h-1.162v1.161
                  h-8.71c-0.321,0-0.581,0.26-0.581,0.581c0,0.321,0.26,0.581,0.581,0.581h8.71v1.161h1.162v-1.161h1.742
                  c0.32,0,0.58-0.26,0.58-0.581C16.388,9.679,16.128,9.419,15.808,9.419z M17.55,0.708H2.451c-0.962,0-1.742,0.78-1.742,1.742v15.1
                  c0,0.961,0.78,1.74,1.742,1.74H17.55c0.962,0,1.742-0.779,1.742-1.74v-15.1C19.292,1.488,18.512,0.708,17.55,0.708z M18.13,17.551
                  c0,0.32-0.26,0.58-0.58,0.58H2.451c-0.321,0-0.581-0.26-0.581-0.58v-15.1c0-0.321,0.26-0.581,0.581-0.581H17.55
                  c0.32,0,0.58,0.26,0.58,0.581V17.551z M15.808,4.774H9.419V3.612H8.258v1.162H4.193c-0.321,0-0.581,0.26-0.581,0.581
                  s0.26,0.581,0.581,0.581h4.065v1.162h1.161V5.935h6.388c0.32,0,0.58-0.26,0.58-0.581S16.128,4.774,15.808,4.774z"></path>
              </svg> -->
            </button>
            <button mat-icon-button class="edit-btn" aria-label="Add Machine" 
            (click)="openMachineDailog(element.userId)" pTooltip="Add Machine" tooltipPosition="top">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M6.634,13.591H2.146c-0.247,0-0.449,0.201-0.449,0.448v2.692c0,0.247,0.202,0.449,0.449,0.449h4.488c0.247,0,0.449-0.202,0.449-0.449v-2.692C7.083,13.792,6.881,13.591,6.634,13.591 M6.185,16.283h-3.59v-1.795h3.59V16.283zM6.634,8.205H2.146c-0.247,0-0.449,0.202-0.449,0.449v2.692c0,0.247,0.202,0.449,0.449,0.449h4.488c0.247,0,0.449-0.202,0.449-0.449V8.653C7.083,8.407,6.881,8.205,6.634,8.205 M6.185,10.897h-3.59V9.103h3.59V10.897z M6.634,2.819H2.146c-0.247,0-0.449,0.202-0.449,0.449V5.96c0,0.247,0.202,0.449,0.449,0.449h4.488c0.247,0,0.449-0.202,0.449-0.449V3.268C7.083,3.021,6.881,2.819,6.634,2.819 M6.185,5.512h-3.59V3.717h3.59V5.512z M15.933,5.683c-0.175-0.168-0.361-0.33-0.555-0.479l1.677-1.613c0.297-0.281,0.088-0.772-0.31-0.772H9.336c-0.249,0-0.448,0.202-0.448,0.449v7.107c0,0.395,0.471,0.598,0.758,0.326l1.797-1.728c0.054,0.045,0.107,0.094,0.161,0.146c0.802,0.767,1.243,1.786,1.243,2.867c0,1.071-0.435,2.078-1.227,2.837c-0.7,0.671-1.354,1.086-2.345,1.169c-0.482,0.041-0.577,0.733-0.092,0.875c0.687,0.209,1.12,0.314,1.839,0.314c0.932,0,1.838-0.173,2.673-0.505c0.835-0.33,1.603-0.819,2.262-1.449c1.322-1.266,2.346-2.953,2.346-4.751C18.303,8.665,17.272,6.964,15.933,5.683 M15.336,14.578c-1.124,1.077-2.619,1.681-4.217,1.705c0.408-0.221,0.788-0.491,1.122-0.812c0.97-0.929,1.504-2.168,1.504-3.485c0-1.328-0.539-2.578-1.521-3.516c-0.178-0.17-0.357-0.321-0.548-0.456c-0.125-0.089-0.379-0.146-0.569,0.041L9.769,9.327v-5.61h5.861l-1.264,1.216c-0.099,0.094-0.148,0.229-0.137,0.366c0.014,0.134,0.088,0.258,0.202,0.332c0.313,0.204,0.61,0.44,0.882,0.7c1.158,1.111,2.092,2.581,2.092,4.145C17.405,12.026,16.48,13.482,15.336,14.578"
                  fill="white" />
              </svg>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="userColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: userColumns;"></tr>
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching</td>
      </tr>
    </table>  
    <mat-paginator 
      class="basic-paginataor" 
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons>
    </mat-paginator>
  </div>
  </mat-card-content>    
</mat-card>
</section>
<p-dialog header="Edit User Permissions" [(visible)]="displayUserPermission" [modal]="true" [style]="{width: '90vw'}" [maximizable]="true" [baseZIndex]="10000"
[draggable]="false" [resizable]="false">
<form [formGroup]="userPermissionForm" (ngSubmit)="searchUserPermissions()" class="forms-sample">
  <p-treeTable [value]="files5" selectionMode="checkbox" [(selection)]="selectedNodePermission"
  (onNodeSelect)="nodeSelect($event)" (onNodeUnselect)="nodeUnselect($event)" (onHeaderCheckboxToggle)="onHeaderCheckboxToggle($event)">
    <ng-template pTemplate="caption">
      <div class="p-d-flex">
          <p-treeTableHeaderCheckbox></p-treeTableHeaderCheckbox>
          <span class="p-ml-2">Select All</span>
      </div>
  </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th>Menu Name</th>
            <th>Action</th>
            <th style="width: 80px;">IsSelect</th>
            <th style="width: 80px;">IsRead</th>
            <th style="width: 80px;">IsCreate</th>
            <th style="width: 80px;">IsUpdate</th>
            <th style="width: 80px;">IsDelete</th>
            <th style="width: 80px;">IsApprove</th>
            <th style="width: 80px;">IsPrint</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
        <tr>
            <td>
                <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                <p-treeTableCheckbox [value]="rowNode" ></p-treeTableCheckbox>

                {{rowData.MenuName}}
            </td>
            <td>{{rowData.Action}}</td>
            <td><mat-checkbox color="accent" (change)="selectionChange($event, rowData.MenuId)" [checked]="rowData.IsSelect"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="readChange($event, rowData.MenuId)" [checked]="rowData.IsRead"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="writeChange($event, rowData.MenuId)" [checked]="rowData.IsCreate"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="updateChange($event, rowData.MenuId)"  [checked]="rowData.IsUpdate"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="deleteChange($event, rowData.MenuId)" [checked]="rowData.IsDelete"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="approveChange($event, rowData.MenuId)" [checked]="rowData.IsApprove"></mat-checkbox> </td>
            <td><mat-checkbox color="accent" (change)="printChange($event, rowData.MenuId)" [checked]="rowData.IsPrint"></mat-checkbox></td>
          
        </tr>
    </ng-template>
</p-treeTable>
  <!-- <p-treeTable [value]="files5" [columns]="cols" selectionMode="checkbox" [(selection)]="selectedNodes3">
    <ng-template pTemplate="caption">
      <div class="p-d-flex">
        <p-treeTableHeaderCheckbox></p-treeTableHeaderCheckbox>
        <span class="p-ml-2">Toggle All</span>
      </div>
    </ng-template>
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of columns">
          {{col.header}}
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
      <tr>
        <td *ngFor="let col of columns; let i = index">
          <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0"></p-treeTableToggler>
          <p-treeTableCheckbox [value]="rowNode" *ngIf="i == 0" ></p-treeTableCheckbox>
          {{rowData[col.field]}}
        </td>
      </tr>
    </ng-template>
  </p-treeTable> -->
  <!-- <p-table [value]="userPersmissions">
    <ng-template pTemplate="header">
        <tr>
            <th>Select</th>
            <th>Parent Menu	</th>
            <th>Main Menu	</th>            
            <th>Action</th>
            <th>Read</th>
            <th>Write</th>
            <th>Edit</th>
            <th>Delete</th>
            <th>Approve</th>
            <th>Print</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-menu>
        <tr>
          <td><mat-checkbox color="accent" (change)="selectionChange($event, menu.MenuId)" [checked]="menu.IsSelect"></mat-checkbox></td>
          <td>{{menu.ParentName}}</td> 
          <td>{{menu.MenuName}}</td>
            <td>{{menu.Actions}}</td>
            <td><mat-checkbox color="accent" (change)="readChange($event, menu.MenuId)" [checked]="menu.IsRead"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="writeChange($event, menu.MenuId)" [checked]="menu.IsCreate"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="updateChange($event, menu.MenuId)"  [checked]="menu.IsUpdate"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="deleteChange($event, menu.MenuId)" [checked]="menu.IsDelete"></mat-checkbox></td>
            <td><mat-checkbox color="accent" (change)="approveChange($event, menu.MenuId)" [checked]="menu.IsApprove"></mat-checkbox> </td>
            <td><mat-checkbox color="accent" (change)="printChange($event, menu.MenuId)" [checked]="menu.IsPrint"></mat-checkbox></td>
          </tr>
    </ng-template>
</p-table> -->
</form>
    <ng-template pTemplate="footer">
      <button mat-flat-button color="accent" type="button" class="btn-accent" [disabled]="userPersmissions === undefined" (click)="saveData()">Update</button>

      <!-- <button type="button" class="btn btn-light" data-dismiss="modal" (click)="modal.close()">Cancel</button> -->
    </ng-template>
</p-dialog>
  <p-dialog [contentStyle]="{'overflow': 'visible'}" [closable]="true"  header="{{formMode ? 'Add' : 'Update'}} User" [(visible)]="displayUserRegistration" [modal]="true" [style]="{width: '70vw'}" [maximizable]="true" [baseZIndex]="10000"
    [draggable]="false" [resizable]="false">
    <br/>
    <form [formGroup]="userForm"   (ngSubmit)="formMode ? register() : updateUser()" class="forms-sample">
    <div class="p-grid p-fluid">   
        <div class="p-field p-col-3">
          <label class="required">Please Select Group</label>
            <p-dropdown [disabled]="true"  (onChange)="onGroupChange()" [ngClass]="{
              'is-invalid':
                userForm.get('group')?.errors &&
                userForm.get('group')?.touched
            }" [options]="groups" formControlName="group" 
            placeholder="Select a Group" optionLabel="egDesc" 
            [showClear]="true">
        </p-dropdown>
          <p class="invalid-feedback" *ngIf="
          userForm.get('group')?.touched &&
          userForm.get('group')?.hasError('required')
        ">
            * please select group 
          </p>
        </div>
        
        <div class="p-field p-col-3">
          <label >Please Select Role</label>
          <p-multiSelect [ngClass]="{
              'is-invalid':
                userForm.get('role')?.errors &&
                userForm.get('role')?.touched
            }" [options]="roles" formControlName="role" 
            placeholder="Select a Role" optionLabel="name" 
            [showClear]="true">
          </p-multiSelect>
          <p class="invalid-feedback" *ngIf="
          userForm.get('role')?.touched &&
          userForm.get('role')?.hasError('required')
        ">
            * please select role 
          </p>
        </div>
        <div class="p-field p-col-3">
          <label class="required">Username</label>
          <input  [ngClass]="{
            'is-invalid':
              userForm.get('username')?.errors &&
              userForm.get('username')?.touched
          }" type="text" class="form-control" formControlName="username" pInputText  placeholder="enter username">
          <p class="invalid-feedback" *ngIf="
          userForm.get('username')?.touched &&
          userForm.get('username')?.hasError('required')">
            * user name is required!
          </p>
        </div>
        <div class="p-field p-col-3">
          <label class="required">First Name</label>
          <input [ngClass]="{
            'is-invalid':
              userForm.get('firstName')?.errors &&
              userForm.get('firstName')?.touched
          }" type="text" class="form-control" formControlName="firstName"  pInputText placeholder="enter first name">
          <p class="invalid-feedback" *ngIf="
          userForm.get('firstName')?.touched &&
          userForm.get('firstName')?.hasError('required')">
              * first name is required!
          </p>
        </div>
        <div class="p-field p-col-3">
          <label class="required">Last Name</label>
          <input [ngClass]="{
            'is-invalid':
              userForm.get('lastName')?.errors &&
              userForm.get('lastName')?.touched
          }" type="text" class="form-control" formControlName="lastName"  pInputText placeholder="enter last name">
          <p class="invalid-feedback" *ngIf="
          userForm.get('lastName')?.touched &&
          userForm.get('lastName')?.hasError('required')">
            * last name is required!
          </p>
        </div>
        <div class="p-field p-col-3">
          <label class="required">Phone Number</label>
          <input [ngClass]="{
            'is-invalid':
              userForm.get('phoneNumber')?.errors &&
              userForm.get('phoneNumber')?.touched
          }" type="number" min="11" class="form-control" formControlName="phoneNumber"  pInputText placeholder="enter phone number">
          <p class="invalid-feedback" *ngIf="
          userForm.get('phoneNumber')?.touched &&
          userForm.get('phoneNumber')?.hasError('required')">
              * phone number is required!
          </p>
        </div>
        <div class="p-field p-col-3">
          <label class="required">Email address</label>
                  <input [ngClass]="{
                    'is-invalid':
                    userForm.get('email')?.errors &&
                    userForm.get('email')?.touched
                  }" type="email" class="form-control" formControlName="email"  pInputText placeholder="enter email address">
                  <p class="invalid-feedback" *ngIf="
                  userForm.get('email')?.touched &&
                  userForm.get('email')?.hasError('required')
                ">
                    * invalid email
                  </p>
                  <p
                    class="invalid-feedback"
                    *ngIf="
                    userForm.get('email')?.hasError('email') &&
                    userForm.get('email')?.touched
                    "
                  >
                    * invalid email
                  </p>
        </div>
        <div class="p-field p-col-3" *ngIf="formMode"> 
          <label class="required">Password</label>
          <input pPassword  [ngClass]="{
            'is-invalid':
              userForm.get('password')?.errors &&
              userForm.get('password')?.touched
          }" type="password" formControlName="password"  pInputText class="form-control" placeholder="Password">
          <p class="invalid-feedback" *ngIf="
          userForm.get('password')?.touched &&
          userForm.get('password')?.hasError('required')
        ">
            * password is required
          </p>
          <p class="invalid-feedback" *ngIf="
          userForm.get('password')?.touched &&
          userForm.get('password')?.hasError('minLength')
        ">
            * password is atleast 4 characters
          </p>
        </div>
        <div class="p-field p-col-3">  <label>Image</label>
          <input  pInputText
              formControlName="image"  accept="image/x-png,image/gif,image/jpeg"
              id="file" 
              type="file" 
              class="form-control"
              (change)="onFileChange($event)">
             </div>
        <div class="p-field p-col-3"><img [src]="imageSrc" *ngIf="imageSrc" style="height: 100px; width:250px"> </div>
        

    </div>
    <button style="float: right;" mat-flat-button color="accent" type="submit" [disabled]="!userForm.valid"  class="btn-accent"> {{formMode ? 'Register' : 'Update'}} </button>

   </form>
</p-dialog>
<!-- Machine Dialog -->
<!-- <p-dialog [contentStyle]="{'overflow': 'visible'}" [closable]="true" header="Add Machine"
  [(visible)]="displayMachineDailog" [modal]="true" [style]="{width: '70vw'}" [maximizable]="true"
  [baseZIndex]="10000" [draggable]="false" [resizable]="true" styleClass="p-fluid"> -->
  <p-dialog header="Add Machine" [(visible)]="displayMachineDailog" [closable]="true" [style]="{width: '70vw'}" [baseZIndex]="10000" [maximizable]="true" [modal]="true" 
    [resizable]="true" [contentStyle]="{height: '700px'}" styleClass="p-fluid">
  <br />
  
  <form [formGroup]="machineForm" (ngSubmit)="userMachineAccess()" class="forms-sample">
    <div class="tree-controls">
      <button mat-flat-button class="btn-tree-control" (click)="collapseAll()" type="button">
        <div class="icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="12" fill="#824AED" />
            <path
              d="M11.0118 12.9848C10.9331 12.8973 10.8218 12.8402 10.6947 12.8398L7.10183 12.8348C6.86392 12.8344 6.67141 13.0269 6.67183 13.2648C6.67224 13.5027 6.94974 13.7702 7.06891 13.8894L7.97764 14.7982L5.33307 17.4173L6.58307 18.6673L9.18891 16.0098L10.0976 16.9186C10.2943 17.1152 10.4939 17.3244 10.7318 17.3248C10.9697 17.3252 11.1622 17.1327 11.1618 16.8948L11.1568 13.3019C11.1564 13.1748 11.0993 13.0636 11.0118 12.9848ZM16.0764 9.1569L18.6664 6.58398L17.4164 5.33398L14.8443 7.9169L13.9201 6.9869C13.7201 6.78564 13.5172 6.57148 13.2756 6.57107C13.0335 6.57065 12.8381 6.76773 12.8381 7.01106L12.843 10.6886C12.843 10.8186 12.9014 10.9323 12.9906 11.0131C13.071 11.1027 13.1839 11.161 13.3131 11.1615L16.9672 11.1665C17.2089 11.1669 17.4047 10.9698 17.4047 10.7265C17.4043 10.4831 17.1222 10.209 17.001 10.0873L16.0764 9.1569Z"
              fill="white" />
          </svg>
        </div>
        <p class="btn-text">Collapse All</p>
      </button>
      <button mat-flat-button class="btn-tree-control" (click)="expandAll()" type="button">
        <div class="icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="12" fill="#3AAFE4" />
            <path
              d="M11.0118 12.9848C10.9331 12.8973 10.8218 12.8402 10.6947 12.8398L7.10183 12.8348C6.86392 12.8344 6.67141 13.0269 6.67183 13.2648C6.67224 13.5027 6.94974 13.7702 7.06891 13.8894L7.97764 14.7982L5.33307 17.4173L6.58307 18.6673L9.18891 16.0098L10.0976 16.9186C10.2943 17.1152 10.4939 17.3244 10.7318 17.3248C10.9697 17.3252 11.1622 17.1327 11.1618 16.8948L11.1568 13.3019C11.1564 13.1748 11.0993 13.0636 11.0118 12.9848ZM16.0764 9.1569L18.6664 6.58398L17.4164 5.33398L14.8443 7.9169L13.9201 6.9869C13.7201 6.78564 13.5172 6.57148 13.2756 6.57107C13.0335 6.57065 12.8381 6.76773 12.8381 7.01106L12.843 10.6886C12.843 10.8186 12.9014 10.9323 12.9906 11.0131C13.071 11.1027 13.1839 11.161 13.3131 11.1615L16.9672 11.1665C17.2089 11.1669 17.4047 10.9698 17.4047 10.7265C17.4043 10.4831 17.1222 10.209 17.001 10.0873L16.0764 9.1569Z"
              fill="white" />
          </svg>
        </div>
        <p class="btn-text">Expand All</p>
      </button>
    </div>
    <p-tree [value]="machineTree" selectionMode="checkbox" layout="vertical" [(selection)]="selectedMachine" scrollHeight="flex"></p-tree>
    
    <!--
    <div class="p-grid p-fluid">
      <div class="p-field p-col-3">
        <label class="required">Plant</label>
        <p-multiSelect  (onChange)="getProductLine()" [ngClass]="{
                  'is-invalid':
                  machineForm.get('plant')?.errors &&
                    machineForm.get('plant')?.touched
                }" [options]="machineplants" formControlName="plant" placeholder="Select plant" optionLabel="ptDesc"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('plant')?.touched &&
              machineForm.get('plant')?.hasError('required')
            ">
          * please select plant
        </p>
      </div>    
      <div class="p-field p-col-3">
        <label class="required">Product Line</label>
        <p-multiSelect (onChange)="getProductUnits()" [ngClass]="{
                  'is-invalid':
                  machineForm.get('productLine')?.errors &&
                    machineForm.get('productLine')?.touched
                }" [options]="productLines" formControlName="productLine" placeholder="Select Product Line" optionLabel="plDesc"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('productLine')?.touched &&
              machineForm.get('productLine')?.hasError('required')
            ">
          * please select product line
        </p>
      </div> 
      <div class="p-field p-col-3">
        <label class="required">Product Unit</label>
        <p-multiSelect (onChange)="getAssembly()" [ngClass]="{
                  'is-invalid':
                  machineForm.get('productUnit')?.errors &&
                  machineForm.get('productUnit')?.touched
                }" [options]="productUnits" formControlName="productUnit" placeholder="Select Product Unit" optionLabel="puDesc"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('productUnit')?.touched &&
              machineForm.get('productUnit')?.hasError('required')
            ">
          * please select product unit
        </p>
      </div> 
      <div class="p-field p-col-3">
        <label class="required">Assembly</label>
        <p-multiSelect (onChange)="getSubAssembly()" [ngClass]="{
                  'is-invalid':
                  machineForm.get('assembly')?.errors &&
                  machineForm.get('assembly')?.touched
                }" [options]="assemblies" formControlName="assembly" placeholder="Select Assembly" optionLabel="assblyDesc"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('assembly')?.touched &&
              machineForm.get('assembly')?.hasError('required')
            ">
          * please select Assembly
        </p>
      </div> 
      <div class="p-field p-col-3">
        <label class="required">Sub Assembly</label>
        <p-multiSelect (onChange)="getComponent()" [ngClass]="{
                  'is-invalid':
                  machineForm.get('subassembly')?.errors &&
                    machineForm.get('subassembly')?.touched
                }" [options]="subAssemblies" formControlName="subassembly" placeholder="Select Assembly" optionLabel="sAsblyDesc"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('subassembly')?.touched &&
              machineForm.get('subassembly')?.hasError('required')
            ">
          * please select subassembly
        </p>
      </div> 
      <div class="p-field p-col-3">
        <label class="required">Component</label>
        <p-multiSelect [ngClass]="{
                  'is-invalid':
                  machineForm.get('component')?.errors &&
                    machineForm.get('component')?.touched
                }" [options]="components" formControlName="component" placeholder="Select Component" optionLabel="componentName"
          [showClear]="true">
        </p-multiSelect>
        <p class="invalid-feedback" *ngIf="
        machineForm.get('component')?.touched &&
        machineForm.get('component')?.hasError('required')
            ">
          * please select Component
        </p>
      </div> 
    </div>
  
  -->
  <button style="float: right;" mat-flat-button color="accent" type="submit" [disabled]="!machineForm.valid"
  class="btn-accent"> Save </button>
  </form> 
 
</p-dialog>
<!-- End Machine Dialog -->

